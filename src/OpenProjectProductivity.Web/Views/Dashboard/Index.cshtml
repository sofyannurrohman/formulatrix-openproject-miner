@model OpenProductivity.Web.DTOs.DashboardCountsDto
@{
    ViewData["Title"] = "Dashboard";
}

<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-blue-500 text-white p-4 rounded-md shadow flex items-center">
        <img src="~/Assets/user.png" alt="Users" class="w-12 h-12 mr-4" />
        <div>
            <h2 class="text-lg font-semibold">Users</h2>
            <p class="text-3xl font-bold">@Model.TotalUsers</p>
        </div>
    </div>

    <div class="bg-green-500 text-white p-4 rounded-md shadow flex items-center">
        <img src="~/Assets/project.png" alt="Projects" class="w-12 h-12 mr-4" />
        <div>
            <h2 class="text-lg font-semibold">Projects</h2>
            <p class="text-3xl font-bold">@Model.TotalProjects</p>
        </div>
    </div>

    <div class="bg-yellow-500 text-white p-4 rounded-md shadow flex items-center">
        <img src="~/Assets/workpackage.png" alt="Work Packages" class="w-12 h-12 mr-4" />
        <div>
            <h2 class="text-lg font-semibold">Work Packages</h2>
            <p class="text-3xl font-bold">@Model.TotalWorkPackages</p>
        </div>
    </div>

    <div class="bg-red-500 text-white p-4 rounded-md shadow flex items-center">
        <img src="~/Assets/activity.png" alt="Activities" class="w-12 h-12 mr-4" />
        <div>
            <h2 class="text-lg font-semibold">Activities</h2>
            <p class="text-3xl font-bold">@Model.TotalActivities</p>
        </div>
    </div>
</div>

<!-- 2-Column Charts -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Bar Chart -->
    <div class="bg-white p-8 rounded-md shadow" style="height:250px;">
        <h2 class="text-md font-semibold mb-2">Counts Bar Chart</h2>
        <canvas id="barChart" style="width:100%; height:100%; display:block;"></canvas>
    </div>

    <!-- Pie Chart -->
    <div class="bg-white p-8 rounded-md shadow" style="height:250px;">
        <h2 class="text-md font-semibold mb-2">Counts Pie Chart</h2>
        <canvas id="pieChart" style="width:100%; height:100%; display:block;"></canvas>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Destroy previous charts if they exist
        if (window.barChartInstance) window.barChartInstance.destroy();
        if (window.pieChartInstance) window.pieChartInstance.destroy();

        const barCtx = document.getElementById('barChart').getContext('2d');
        window.barChartInstance = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['Users', 'Projects', 'Work Packages', 'Activities'],
                datasets: [{
                    label: 'Counts',
                    data: [
                        @Model.TotalUsers,
                        @Model.TotalProjects,
                        @Model.TotalWorkPackages,
                        @Model.TotalActivities
                    ],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(34, 197, 94, 0.7)',
                        'rgba(234, 179, 8, 0.7)',
                        'rgba(239, 68, 68, 0.7)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(34, 197, 94, 1)',
                        'rgba(234, 179, 8, 1)',
                        'rgba(239, 68, 68, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
            }
        });

        const pieCtx = document.getElementById('pieChart').getContext('2d');
        window.pieChartInstance = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: ['Users', 'Projects', 'Work Packages', 'Activities'],
                datasets: [{
                    data: [
                        @Model.TotalUsers,
                        @Model.TotalProjects,
                        @Model.TotalWorkPackages,
                        @Model.TotalActivities
                    ],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(34, 197, 94, 0.7)',
                        'rgba(234, 179, 8, 0.7)',
                        'rgba(239, 68, 68, 0.7)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(34, 197, 94, 1)',
                        'rgba(234, 179, 8, 1)',
                        'rgba(239, 68, 68, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });
    </script>
}
