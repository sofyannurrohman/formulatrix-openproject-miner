@{
    ViewData["Title"] = "Dashboard";
}

<div class="space-y-6">

    <!-- Project & Goal Period Selection -->
    <div class="flex space-x-4 items-center">
        <div>
            <label class="block text-gray-700 mb-1">Select Project</label>
            <select class="border rounded-lg px-3 py-2 w-60">
                <option>Inventory</option>
                <option>Meeting Room</option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 mb-1">Select Goal Period</label>
            <select class="border rounded-lg px-3 py-2 w-60">
                <option>2025-H1</option>
                <option>2025-H2</option>
            </select>
        </div>
    </div>
    <!-- Charts Section -->
    <div class="bg-white shadow rounded-lg p-6 mt-6">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Horizontal Bar Chart: Avg Duration per Member -->
            <div>
                <h3 class="text-lg font-semibold mb-2">Average Duration per Member (Days)</h3>
                <div class="w-full h-64 md:h-40">
                    <canvas id="avgDurationChart"></canvas>
                </div>
            </div>

            <!-- Pie Chart: Task Type Distribution -->
            <div>
                <h3 class="text-lg text-center font-semibold mb-2">Task Type Distribution</h3>
                <div class="w-full h-64 md:h-40">
                    <canvas id="taskTypeChart"></canvas>
                </div>
            </div>
            <div class="bg-white shadow rounded-lg">
                <h2 class="text-xl font-bold mb-4">Productivity Score Over Time</h2>
                <div class="w-full h-64 md:h-40">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Productivity Summary -->
    <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">Team Productivity Summary</h2>

        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Member
                    </th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Total
                        User Stories</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Total
                        Issues</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Avg
                        Duration (Days)</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Tasks
                        Completed</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">
                        Productivity Score</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <!-- Sample hardcoded data -->
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">John Doe</td>
                    <td class="px-4 py-2">12</td>
                    <td class="px-4 py-2">5</td>
                    <td class="px-4 py-2">3.2</td>
                    <td class="px-4 py-2">17</td>
                    <td class="px-4 py-2">92</td>
                    <td class="px-4 py-2"><button
                            class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-3 py-1 rounded-lg transition">
                            <span>View Details</span>
                        </button>

                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">Jane Smith</td>
                    <td class="px-4 py-2">8</td>
                    <td class="px-4 py-2">10</td>
                    <td class="px-4 py-2">4.8</td>
                    <td class="px-4 py-2">18</td>
                    <td class="px-4 py-2">78</td>
                    <td class="px-4 py-2"><button
                            class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-3 py-1 rounded-lg transition">
                            <span>View Details</span>
                        </button>

                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">Bob Wilson</td>
                    <td class="px-4 py-2">15</td>
                    <td class="px-4 py-2">3</td>
                    <td class="px-4 py-2">2.9</td>
                    <td class="px-4 py-2">18</td>
                    <td class="px-4 py-2">95</td>
                    <td class="px-4 py-2"><button
                            class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-3 py-1 rounded-lg transition">
                            <span>View Details</span>
                        </button>

                </tr>
            </tbody>
        </table>
    </div>

    <!-- Member Details Drill-Down -->
    <div class="bg-white shadow rounded-lg p-6 mt-6">
        <h2 class="text-xl font-bold mb-4">Task Details for John Doe</h2>

        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Type</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Subject
                    </th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Start
                    </th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">End</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Duration
                        (Days)</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Status
                        History</th>
                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Notes
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">57175</td>
                    <td class="px-4 py-2">User Story</td>
                    <td class="px-4 py-2">Implement Login Feature</td>
                    <td class="px-4 py-2">2025-09-01 09:00</td>
                    <td class="px-4 py-2">2025-09-05 16:00</td>
                    <td class="px-4 py-2">4.3</td>
                    <td class="px-4 py-2">In Progress → Developed → Done</td>
                    <td class="px-4 py-2">No rework</td>
                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">57176</td>
                    <td class="px-4 py-2">Issue</td>
                    <td class="px-4 py-2">Fix UI Bug</td>
                    <td class="px-4 py-2">2025-09-10 10:00</td>
                    <td class="px-4 py-2">2025-09-12 14:00</td>
                    <td class="px-4 py-2">2.2</td>
                    <td class="px-4 py-2">In Progress → Developed → Done</td>
                    <td class="px-4 py-2">No rework</td>
                </tr>
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">57177</td>
                    <td class="px-4 py-2">User Story</td>
                    <td class="px-4 py-2">API Integration</td>
                    <td class="px-4 py-2">2025-09-15 08:00</td>
                    <td class="px-4 py-2">2025-09-20 17:00</td>
                    <td class="px-4 py-2">5.4</td>
                    <td class="px-4 py-2">In Progress → Developed → In Progress → Done</td>
                    <td class="px-4 py-2">Rework detected (1 loop)</td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

@section Scripts {
    <script>
        // Horizontal Bar Chart: Avg Duration per Member
        const ctx1 = document.getElementById('avgDurationChart').getContext('2d');
        const avgDurationChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['John Doe', 'Jane Smith', 'Bob Wilson'],
                datasets: [{
                    label: 'Avg Duration (Days)',
                    data: [3.2, 4.8, 2.9],
                    backgroundColor: ['#3b82f6', '#ef4444', '#10b981']
                }]
            },
            options: {
                indexAxis: 'y', // horizontal bar
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: false }
                },
                scales: {
                    x: { beginAtZero: true },
                    y: { ticks: { font: { size: 14 } } }
                }
            }
        });

        // Pie Chart: Task Type Distribution
        const ctx2 = document.getElementById('taskTypeChart').getContext('2d');
        const taskTypeChart = new Chart(ctx2, {
            type: 'pie',
            data: {
                labels: ['User Story', 'Issue'],
                datasets: [{
                    label: 'Task Type',
                    data: [35, 18], // hardcoded total tasks
                    backgroundColor: ['#3b82f6', '#f59e0b']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    title: { display: false }
                }
            }
        });
        // Line Chart: Productivity Score Over Time
        const ctx3 = document.getElementById('lineChart').getContext('2d');
        const lineChart = new Chart(ctx3, {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
                datasets: [
                    {
                        label: 'John Doe',
                        data: [85, 88, 90, 92, 94],
                        borderColor: '#3b82f6',
                        backgroundColor: '#3b82f6',
                        tension: 0.3, // smooth curves
                        fill: false,
                        pointStyle: 'circle',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    {
                        label: 'Jane Smith',
                        data: [75, 78, 80, 82, 78],
                        borderColor: '#ef4444',
                        backgroundColor: '#ef4444',
                        tension: 0.3,
                        fill: false,
                        pointStyle: 'circle',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    {
                        label: 'Bob Wilson',
                        data: [90, 92, 93, 95, 95],
                        borderColor: '#10b981',
                        backgroundColor: '#10b981',
                        tension: 0.3,
                        fill: false,
                        pointStyle: 'circle',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    title: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, max: 100, title: { display: true, text: 'Productivity Score' } },
                    x: { title: { display: true, text: 'Weeks' } }
                }
            }
        });

    </script>
}

<script>
$(document).ready(function() {
    $('#productivityTable').DataTable({
        paging: true,
        searching: true,
        ordering: true,
        info: true,
        lengthChange: true,
        pageLength: 5
    });
});
</script>